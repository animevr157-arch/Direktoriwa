<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Direktori Saluran WhatsApp</title>
<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;}
body{background:#f2f4f8;}
header{background:#25D366;color:white;padding:20px;text-align:center;}
header h1{margin:0;font-size:26px;}
header p{margin-top:6px;opacity:0.9;}
.container{max-width:900px;margin:20px auto;padding:15px;}
.submit-box{background:#fff;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
.submit-box input{width:100%;padding:12px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;font-size:15px;}
.submit-box button{width:100%;padding:12px;background:#25D366;color:white;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
.search-box{margin-bottom:20px;}
.search-box input{width:100%;padding:12px;font-size:16px;border-radius:8px;border:1px solid #ccc;}
.channel-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;}
.card{background:white;border-radius:12px;padding:15px;box-shadow:0 4px 10px rgba(0,0,0,0.08);text-align:center;}
.card h3{margin:0 0 8px;font-size:18px;}
.card p{font-size:14px;color:#555;margin-bottom:10px;}
.card a{display:inline-block;padding:8px 12px;background:#25D366;color:white;text-decoration:none;border-radius:6px;font-size:14px;}
footer{text-align:center;padding:15px;font-size:13px;color:#777;margin-top:20px;}
/* POPUP DONASI */
.donate-popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:9999;}
.donate-box{background:#fff;padding:25px;border-radius:14px;max-width:400px;width:90%;text-align:center;position:relative;}
.donate-box span{position:absolute;top:10px;right:15px;font-size:22px;cursor:pointer;}
.donate-box a{display:inline-block;margin-top:15px;padding:10px 15px;background:#FF6B6B;color:white;border-radius:8px;text-decoration:none;font-weight:bold;}
/* POPUP JANGAN SERAKAH */
#greedyPopup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:99999;justify-content:center;align-items:center;}
#greedyPopup div{background:white;padding:25px;border-radius:16px;max-width:320px;width:90%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.3);}
#greedyPopup h2{margin:0;color:#ef4444;}
#greedyPopup p{margin:12px 0;color:#555;}
#greedyPopup button{background:#25D366;color:white;border:none;padding:10px 18px;border-radius:10px;font-size:15px;cursor:pointer;}
</style>
</head>
<body>

<!-- POPUP DONASI -->
<div id="donatePopup" class="donate-popup">
  <div class="donate-box">
    <span onclick="closeDonate()">âœ•</span>
    <h2>Selamat datang!</h2>
    <p>Kunjungi saluran WhatsApp utama:</p>
    <a href="https://whatsapp.com/channel/0029VbBS24J3gvWYXNUrRs45" target="_blank">Masuk Saluran</a>
    <p style="margin-top:15px;font-weight:bold;">DONASI</p>
    <a href="https://saweria.co/Animevora" target="_blank">Donasi Sekarang</a>
  </div>
</div>

<!-- POPUP JANGAN SERAKAH -->
<div id="greedyPopup">
  <div>
    <h2>ðŸ˜¡ Jangan Serakah!</h2>
    <p>Link ini sudah pernah kamu submit.</p>
    <button onclick="closeGreedy()">Oke</button>
  </div>
</div>

<header>
  <h1>Direktori Saluran WhatsApp</h1>
  <p>Cari & bagikan saluran WhatsApp terbaik Indonesia</p>
</header>

<div class="container">
  <div class="submit-box">
    <h2>Submit Saluran</h2>
    <input type="text" id="name" placeholder="Nama Saluran WhatsApp"/>
    <input type="text" id="desc" placeholder="Deskripsi singkat saluran"/>
    <input type="text" id="link" placeholder="Link Saluran WhatsApp"/>
    <button onclick="addChannel()">Submit Saluran</button>
  </div>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Cari saluran..."/>
  </div>

  <div class="channel-list" id="channelList"></div>
</div>

<footer>Â© 2025 Direktori Saluran WhatsApp</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyA_0jv1f329SO8WOSSaasi5xOBIBjIvpIM",
  authDomain: "direktoriwa.firebaseapp.com",
  databaseURL: "https://direktoriwa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "direktoriwa",
  storageBucket: "direktoriwa.firebasestorage.app",
  messagingSenderId: "1001709898104",
  appId: "1:1001709898104:web:8cccacd7a597883da1a08d",
  measurementId: "G-MN6H4XRX8W"
};
const app = firebase.initializeApp(firebaseConfig);
const analytics = firebase.analytics();
const db = firebase.database();

const channelList = document.getElementById('channelList');
const searchInput = document.getElementById('searchInput');

// ===== ADD CHANNEL =====
function addChannel(){
  const name = document.getElementById("name").value.trim();
  const desc = document.getElementById("desc").value.trim();
  const link = document.getElementById("link").value.trim();

  if(!name || !desc || !link){
    alert("Lengkapi semua data");
    return;
  }
  if(!link.includes("whatsapp.com/channel")){
    alert("Link WA tidak valid");
    return;
  }

  const key = btoa(link).replace(/=/g,""); // unik per link

  db.ref("channels/"+key).get().then(snapshot=>{
    if(snapshot.exists()){
      showGreedy(); // popup jangan serakah
    }else{
      db.ref("channels/"+key).set({
        name,
        desc,
        link,
        clicks:0,
        time:Date.now()
      });
      alert("âœ… Saluran berhasil ditambahkan");
      document.getElementById("name").value="";
      document.getElementById("desc").value="";
      document.getElementById("link").value="";
    }
  });
}

// ===== SHOW CHANNEL =====
db.ref('channels').on('value', snapshot=>{
  channelList.innerHTML="";
  const dataArr = [];
  snapshot.forEach(snap=>{
    dataArr.push(snap.val());
  });
  // urut berdasarkan clicks terbanyak
  dataArr.sort((a,b)=>b.clicks - a.clicks);
  dataArr.forEach(data=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `
      <h3>${data.name}</h3>
      <p>${data.desc}</p>
      <a href="${data.link}" target="_blank" onclick="db.ref('channels/${btoa(data.link).replace(/=/g,'')}/clicks').transaction(c=>c+1)">Masuk Saluran</a>
    `;
    channelList.appendChild(div);
  });
});

// ===== SEARCH =====
searchInput.addEventListener('keyup', function(){
  const value = this.value.toLowerCase();
  document.querySelectorAll('.card').forEach(card=>{
    card.style.display = card.innerText.toLowerCase().includes(value)?'block':'none';
  });
});

// ===== POPUP =====
function closeDonate(){document.getElementById("donatePopup").style.display='none';}
function showGreedy(){document.getElementById("greedyPopup").style.display='flex';}
function closeGreedy(){document.getElementById("greedyPopup").style.display='none';}

// ===== DONATE POPUP ONCE =====
window.onload = ()=>{
  if(!localStorage.getItem('donateShown')){
    document.getElementById("donatePopup").style.display='flex';
    localStorage.setItem('donateShown','yes');
  }
};
</script>
</body>
</html>